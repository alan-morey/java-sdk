<!--

    Copyright (c) 2011, salesforce.com, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without modification, are permitted provided
    that the following conditions are met:

       Redistributions of source code must retain the above copyright notice, this list of conditions and the
       following disclaimer.

       Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
       the following disclaimer in the documentation and/or other materials provided with the distribution.

       Neither the name of salesforce.com, inc. nor the names of its contributors may be used to endorse or
       promote products derived from this software without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED
    WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
    PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
    ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
    TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
    HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
    NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
    POSSIBILITY OF SUCH DAMAGE.

-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Database.com Java SDK - Connection Configuration</title>
	<link type="text/css" rel="stylesheet" href="stylesheets/docs.css" media="screen" />
	<link type="text/css" rel="stylesheet" href="stylesheets/header.css" media="screen" />
	<link type="text/css" rel="stylesheet" href="stylesheets/coderay.css" media="screen" />
</head>
<body>

  <div id="force-header"> 
    <h1><a href="force-sdk-overview.html">Database.com Java SDK</a></h1>
  </div>
<div id="bodywrap">
	<div id="docsnav">
    <!--

    Copyright (c) 2011, salesforce.com, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without modification, are permitted provided
    that the following conditions are met:

       Redistributions of source code must retain the above copyright notice, this list of conditions and the
       following disclaimer.

       Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
       the following disclaimer in the documentation and/or other materials provided with the distribution.

       Neither the name of salesforce.com, inc. nor the names of its contributors may be used to endorse or
       promote products derived from this software without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED
    WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
    PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
    ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
    TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
    HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
    NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
    POSSIBILITY OF SUCH DAMAGE.

-->

<ul> <li> <h3>Getting started</h3> <ul> 

<li><a href="force-sdk-overview">Introduction</a></li>

 <li><a href="quick-start">Quick Start</a></li>

 <li><a href="quick-start-on-heroku">Running The Quick Start On Heroku</a></li>

 <li><a href="sts">SpringSource Tool Suite</a></li>

 <li><a href="java-database-terminology">Database.com Terminology</a></li>

 <li><a href="support">Getting Support</a></li>
 
 </ul> </li>

 <li> <h3>Persistence</h3> <ul> 
 
 <li><a href="jpa-provider">JPA Provider Overview</a></li>

 <li><a href="jpa-config-persistence">Configuration</a></li>

 <li><a href="jpa-annotations-standard">Standard JPA Annotations</a></li>

 <li><a href="jpa-annotations-custom">Custom Database.com Annotations</a></li>

 <li><a href="jpa-cud">Creating, Updating, and Deleting Data</a></li>

 <li><a href="jpa-transactions">Transactions</a></li>
  
 <li><a href="jpa-queries">Querying with JPQL</a></li>

 <li><a href="jpa-queries-soql">Querying with SOQL</a></li>

 <li><a href="database-com-datatypes">Database.com Data Types</a></li>

 <li><a href="java-db-com-datatypes-map">Java to Database.com Data Types</a></li>

 <li><a href="jpa-spec-support">JPA 2.0 Specification Support</a></li>

 </ul> </li>

 <li> <h3>Authentication</h3> <ul> 
 
 <li><a href="oauth-auth">OAuth Authentication</a></li>

 <li><a href="spring-security">Spring Security Plugin</a></li>

 <li><a href="retrieve-user-data">Retrieving User Data</a></li>

 </ul> </li>

 <li> <h3>Low-level Connector</h3> <ul> <li><a href="connection-url">Connection Configuration</a></li>

 <li><a href="native-api">Native API Clients</a></li>

 </ul> </li>
 
 <li> <h3>Reference</h3> <ul>

 <li><a href="apidocs">Javadoc</a></li>
 
 <li><a href="source-code">Source Code</a></li>

 </ul> </li>

 </ul>
 
<!--
	topic 'quick-start',        'Quick Start Guide'
	topic 'sts',                'SpringSource Tool Suite'
	topic 'java-force-terminology', 'Force.com Terminology'
end

section 'persistence', "Persistence" do
	topic 'jpa-provider',             'JPA Provider Overview'
	topic 'jpa-config-persistence',   'Configuration'
	topic 'jpa-annotations-standard', 'Standard JPA Annotations'
	topic 'jpa-annotations-custom',   'Custom Force.com Annotations'
	topic 'jpa-cud',                  'Creating, Updating, and Deleting Data'
	topic 'jpa-queries',              'Querying with JPQL'
	topic 'jpa-queries-soql',         'Querying with SOQL'
	topic 'force-datatypes',          'Force.com Data Types'
	topic 'java-force-datatypes-map', 'Java to Force.com Data Types'
	topic 'jpa-spec-support',         'JPA 2.0 Specification Support'
end

section 'authentication', "Authentication" do
	topic 'oauth-auth'  ,       'OAuth Authentication'
	topic 'spring-security',    'Spring Security Plugin'
	topic 'retrieve-user-data',    'Retrieving User Data'
end

section 'connector', "Low-level Connector" do
	topic 'connection-url',     'Connection Configuration'
  topic 'native-api',         'Native API Clients'
end

-->

	</div>

	<div id="content">
		<div class="topic_content">
      <h1>Connection Configuration</h1>

<p>Java applications run with the permissions and sharing of the user that authenticates the application with Database.com. You can configure a JPA connection URL that sets a default integration user to authenticate your application with Database.com. This allows a connection to the database before users authenticate with their own credentials.</p>

<p>If your application requires a user to log in to use some or all of the application, the application runs with the permissions and sharing of the user after they log in.</p>

<p>The Database.com Java SDK includes an OAuth Connector that simplifies the process of using OAuth to authenticate Database.com users.</p>

<h2>Typical Web Application Authentication Scenarios</h2>

<p>This section describes some typical authentication scenarios for Web applications. It is not an exhaustive list and you can use a different scheme for authenticating your applications.</p>

<h3>Application Allows Anonymous Access</h3>

<p>Any user can access the application without authentication.</p>

<p>You must configure JPA connection information for the default integration user that authenticates your application with Database.com. No OAuth credentials are needed since users don't need to authenticate.</p>

<h3>Application Requires User Authentication</h3>

<p>A user must authenticate with their Database.com credentials before accessing the application.</p>

<p>You must configure JPA connection information for the default integration user that authenticates your application with Database.com. This user is used when your application needs to create schema in Database.com. You must configure OAuth credentials if you want to use OAuth to authenticate users.</p>

<h3>Application Requires a Mix of User Authentication and Anonymous Access</h3>

<p>A user can access some application pages without authentication, but they must authenticate with their Database.com credentials before accessing protected application pages.</p>

<p>You must configure JPA connection information for the default integration user that authenticates your application with Database.com. This user is used when your application needs to connect to Database.com. You must configure OAuth credentials if you want to use OAuth to authenticate users.</p>

<p>The next section describes the various options for configuring your JPA connection or OAuth credentials. These options offer you flexibility for managing your configuration information in different environments. For example, you may want to manage authentication information differently in development, staging, and production environments.</p>

<p>You can encode the authentication information in a URL or you can split the information into a few separate properties.</p>

<h2>Connection URLs</h2>

<p>You can encode the JPA connection information for the default integration user and the OAuth credentials in a connection URL using key-value pairs. A connection URL must include credentials in the <em>username</em> and <em>password</em> parameters. If you are using OAuth, also include the <em>oauth_key</em> and <em>oauth_secret</em> parameters.</p>

<p>The format of a connection URL that includes JPA connection information for the default integration user and OAuth credentials is:</p>

<pre>
  <code>force://login.salesforce.com?user=<em>user@salesforcedoc.org</em>&password=<em>samplePassword</em>&oauth_key=<em>xyz</em>&oauth_secret=<em>abc</em></code>
</pre>


<p>Substitute values in the <em>user</em> and <em>password</em> fields with the username and password for the default integration user.</p>

<p>If you are using OAuth, substitute values in the <em>oauth_key</em> and <em>oauth_secret</em> fields with the OAuth consumer key and secret. To generate a consumer key and secret for your application, see <a href="oauth-auth#RAA">remote access applications</a>.</p>

<p>There is also an optional <em>timeout</em> parameter, which is the number of milliseconds to wait to establish a connection before
timing out. This parameter is equivalent to the <strong>datanucleus.datastoreReadTimeout</strong> property in <code>persistence.xml</code>. This connection URL shows sample usage:</p>

<pre>
  <code>force://login.salesforce.com?user=<em>user@salesforcedoc.org</em>&password=<em>samplePassword</em>&timeout=<em>10000</em></code>
</pre>


<p>Each version of the Database.com Java SDK is automatically linked with an API version. The major version of the SDK matches the major version of the API. For example, version 22.0.0 of the SDK uses API version 22.0.</p>

<p><a name ="configConnectionURL"> </a></p>

<h2>Configuring Connection URLs</h2>

<p><strong>Note</strong>: If you are facing issues with connection, please upgrade your version and follow these instructions:</p>

<p>Specify the connection URL in your <code>persistence.xml</code> file as follows:</p>

<pre><code> &lt;property name="datanucleus.ConnectionURL" value="force://login.salesforce.com?user=user@salesforcedoc.org&amp;amp;password=samplePassword" /&gt;
</code></pre>

<p>Notice that &amp; has been escaped as <code>&amp;amp;</code> as &amp; has special meaning in XML files.</p>

<p>You can also configure your connection URL in a system property or environment variable. Then you can reference it in your <code>persistence.xml</code> file with dollar sign curly brace notation:</p>

<pre><code> &lt;property name="datanucleus.ConnectionURL" value="${CONNECTION_URL}" /&gt;
</code></pre>

<p>The Database.com JPA provider will first look for a Java system property named <code>CONNECTION_URL</code> and, if the property doesn't exist, the provider looks for a <code>CONNECTION_URL</code> environment variable.</p>

<p><strong>Note</strong>: The name of the variable is case sensitive so make sure that you have the correct case.</p>

<p>We recommend that you don't store any files that contain your connection URL in version control as the connection URL contains sensitive information. It will also vary from one environment to another so keeping it in version control makes your application lifecycle harder to manage. Using environment variables or system properties is the best way to avoid this.</p>

<p>The format for specifying the environment variable name is the same that is used by Spring's property placeholder configurer. In a Spring-based application, Spring will try to resolve these values for you. This isn't an issue because system properties and environment variables are supported by Spring in the same way. However if you're using Spring, make sure that you have the property placeholder configurer enabled. You can do this by including the following tag in your application context xml:</p>

<pre><code>&lt;bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer" /&gt;
</code></pre>

		</div>
	</div>
</div>
</body>
</html>
